<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
      <!-- using vue, semantic ui and axios -->
      <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
      <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
      <script type="text/javascript" src="//code.jquery.com/jquery-2.1.0.js"></script>
      <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/semantic-ui/1.11.1/semantic.min.js"></script>
      <link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/semantic-ui/1.11.1/semantic.min.css">
      <style>
        .fade-enter-active, .fade-leave-active { transition: all .5s; }
        .fade-enter, .fade-leave-to { opacity: 0; transform: translateY(100px); }
      </style>
  </head>

  <body>
    <div id="app" style="max-width: 90vw; margin: auto;">
      <div class="ui grid">
        <!-- padding top row -->
        <div class="row"></div>

        <!-- input row -->
        <div class="centered row">
          <div class="ten wide column">
            <div class="ui fluid inverted teal action input">
              <input type="text"
                placeholder="digite kwegonian ou utilize o teclado"
                :tabindex="1"
                ref="kInput"
                v-model="kwegoInput">
              <button class="ui teal button"
                :class="{ disabled: loading }"
                :tabindex="2"
                @click="handleTranslate">
                traduzir
              </button>
            </div>
          </div>
        </div>

        <!-- buttons row -->
        <div class="centered row">
          <div  class="sixteen wide center aligned column">
            <div class="ui small buttons">
              <button v-for="(alg, index) in kwegonian"
                :tabindex="index + 3"
                @click="handleKwegoClick(alg)"
                class="ui mini teal button">
                {{ alg }}
              </button>
            </div>
          </div>
        </div>

        <!-- response row -->
        <div class="centered row">
          <div class="eight wide column">
            <transition :duration="{ enter: 500, leave: 1000 }"
              name="fade"
              mode="out-in">
              <div v-if="responseMessage" class="ui fluid left aligned teal segment">
                <div class="ui teal ribbon label">
                  {{ responseMessage.kwego }}
                </div>
                <h2 class="ui right floated header">{{ responseMessage.decimal }}</h2>
                <div class="ui clearing divider"></div>
                <p>{{ responseMessage.roman }}</p>
              </div>
              <div v-if="errorMessage" class="ui fluid left aligned orange segment">
                {{ errorMessage }}
              </div>
            </transition>
          </div>
        </div>

      </div>
    </div>

    <script>
      new Vue({
        el: '#app',
        data: {
          responseMessage: '',
          errorMessage: '',
          kwegoInput: '',
          loading: false,
          kwegonian: ["kil", "jin", "pol", "kilow", "jij", "jinjin", "polsx"].reverse()
        },
        methods: {
          handleKwegoClick (kwego) {
            this.kwegoInput = this.kwegoInput.concat(`${kwego} `)
          },
          handleTranslate () {
            this.loading = true
            this.responseMessage = this.errorMessage = ''
            // prepare the string to the api
            let parsed = this.kwegoInput.replace(/ /g, ',')
            if (parsed.charAt(parsed.length - 1) === ',') {
              parsed = parsed.slice(0, parsed.length - 1)
            }
            axios.get(`/kwego?k=${parsed}`)
              .then(response => (this.responseMessage = response.data))
              .catch(err => { this.errorMessage = err.response.data.message })
              .finally(() => { this.loading = false })
          }
        },
        mounted () {
          this.$refs.kInput.focus()
        }
      })
    </script>
  </body>
</html>
