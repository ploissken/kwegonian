<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
      <!-- using vue, semantic ui and axios -->
      <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
      <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
      <script type="text/javascript" src="//code.jquery.com/jquery-2.1.0.js"></script>
      <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/semantic-ui/1.11.1/semantic.min.js"></script>
      <link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/semantic-ui/1.11.1/semantic.min.css">
      <style>
        .fadeup-enter-active, .fadeup-leave-active, .fade-enter-active, .fade-leave-active { transition: all .5s; }
        .fadeup-enter, .fadeup-leave-to { opacity: 0; transform: translateY(100px); }
        .fade-enter, .fade-leave-to { opacity: 0; transform: translateX(100px); }
        .app-info { position: absolute!important; width: 300px; right: 10px; z-index: 99999;}
        .no-padding { padding: 0!important; margin: 0!important; }
      </style>
      <title>Tradutor Kwegoniano</title>
  </head>

  <body>
    <div id="app" style="max-width: 100vw; margin: auto;">
      <div class="ui grid no-padding">
        <div class="centered row no-padding">
          <div class="sixteen wide column no-padding">
            <a class="ui black right corner label"
              href="https://github.com/ploissken/kwegonian">
              <i class="github icon"></i>
            </a>
          </div>
        </div>

        <!-- padding top row -->
        <div class="centered row">
          <div class="two wide column"></div>
          <div class="twelve wide center aligned column">
            <h3> Tradutor Kwegonian </h3>
          </div>
          <div class="left aligned column" >
            <i class="circular question mark icon"
              @mouseover="displayInfo = true"
              @mouseleave="displayInfo = false"> </i>
              <transition :duration="{ enter: 500, leave: 1000 }"
                name="fade"
                mode="out-in">
                <div v-if="displayInfo"
                  class="ui teal fluid segment app-info">
                    {{ infoMsg }}
                </div>
              </transition>
          </div>
          <div class="column"></div>
        </div>

        <!-- input row -->
        <div class="centered row">
          <div class="ten wide column">
            <div class="ui fluid inverted teal action input">
              <input type="text"
                placeholder="digite kwegonian ou utilize o teclado"
                :tabindex="1"
                ref="kInput"
                v-model="kwegoInput">
              <button class="ui teal button"
                :class="{ disabled: loading }"
                :tabindex="2"
                @click="handleTranslate">
                traduzir
              </button>
            </div>
          </div>
        </div>

        <!-- buttons row -->
        <div class="centered row">
          <div  class="sixteen wide center aligned column">
            <div class="ui small buttons">
              <button v-for="(alg, index) in kwegonian"
                :tabindex="index + 3"
                @click="handleKwegoClick(alg)"
                class="ui mini teal button">
                {{ alg }}
              </button>
            </div>
          </div>
        </div>

        <!-- raw api row -->
        <div class="centered row">
          <div  class="sixteen wide center aligned column">
            Acesse a api crua <a href="">aqui</a>.
          </div>
        </div>

        <!-- response row -->
        <div class="centered row">
          <div class="eight wide column">
            <transition :duration="{ enter: 500, leave: 1000 }"
              name="fadeup"
              mode="out-in">
              <div v-if="responseMessage" class="ui fluid left aligned teal segment">
                <div class="ui teal ribbon label">
                  {{ responseMessage.kwego }}
                </div>
                <h2 class="ui right floated header">{{ responseMessage.decimal }}</h2>
                <div class="ui clearing divider"></div>
                <p>{{ responseMessage.roman }}</p>
              </div>
              <div v-if="errorMessage" class="ui fluid left aligned orange segment">
                {{ errorMessage }}
              </div>
            </transition>
          </div>
        </div>

      </div>
    </div>

    <script>
      new Vue({
        el: '#app',
        data: {
          displayInfo: false,
          responseMessage: '',
          errorMessage: '',
          kwegoInput: '',
          loading: false,
          kwegonian: ["kil", "jin", "pol", "kilow", "jij", "jinjin", "polsx"].reverse()
        },
        computed: {
          infoMsg () {
            return 'Cliente amigável para o consumo da API tradutora de Kwegoniano. ' +
              'Ao clicar no botão traduzir, o input em kwegonian digitado é enviado ao servidor para ser traduzido. ' +
              'A resposta do servidor contém as traduções para romano e decimal. '
          }
        },
        methods: {
          handleKwegoClick (kwego) {
            this.kwegoInput = this.kwegoInput.concat(`${kwego} `)
          },
          handleTranslate () {
            this.loading = true
            this.responseMessage = this.errorMessage = ''
            // prepare the string to the api
            let parsed = this.kwegoInput.replace(/ /g, ',')
            if (parsed.charAt(parsed.length - 1) === ',') {
              parsed = parsed.slice(0, parsed.length - 1)
            }
            axios.get(`/kwego?k=${parsed}`)
              .then(response => (this.responseMessage = response.data))
              .catch(err => { this.errorMessage = err.response.data.message })
              .finally(() => { this.loading = false })
          }
        },
        mounted () {
          this.$refs.kInput.focus()
        }
      })
    </script>
  </body>
</html>
